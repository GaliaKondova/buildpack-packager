#!/usr/bin/env ruby
require 'yaml'
require 'active_support/core_ext/hash/indifferent_access'
require 'buildpack/packager'

unless ARGV.length > 0
  STDERR.puts "Usage:"
  STDERR.puts "  #{File.basename(__FILE__)} online|offline"
  exit 1
end

unless File.exist?('manifest.yml')
  STDERR.puts 'Could not find manifest.yml'
  exit 1
end

manifest = YAML.load_file('manifest.yml').with_indifferent_access

manifest.merge!({
                    root_dir: `pwd`.chomp,
                    mode: ARGV[0].to_sym
                })

Buildpack::Packager.package(manifest)
